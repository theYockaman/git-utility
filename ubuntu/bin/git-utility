#!/usr/bin/env bash

set -euo pipefail
IFS=$'\n\t'

# ----------------------
# Helper Functions
# ----------------------
source "/usr/local/lib/git-utility/utils.sh"


# ----------------------
# Main Menu Function
# ----------------------
main_menu() {

    
    OPTIONS=("Install Repository" "Pull Repository" "Push Repository" "Install Git" "Delete" "Exit")

    while true; do
        CHOICE=$(whiptail --title "Select an Action" --menu "Choose an option:" 20 60 10 \
            "Install Repository" "" \
            "Pull Repository" "" \
            "Push Repository" "" \
            "Config Git" "" \
            "Delete" "" \
            "Exit" "" \
            3>&1 1>&2 2>&3)

        exitstatus=$?
        if [ $exitstatus -ne 0 ] || [ -z "$CHOICE" ]; then
            echo "No selection made. Exiting."
            break
        fi

        case "$CHOICE" in
            "Install Repository") install_repository ;;
            "Pull Repository") pull_repository ;;
            "Push Repository") push_repository ;;
            "Config Git") config_git ;;  
            "Delete") delete_app ;;
            "Exit") exit_program ;;
            *) whiptail --title "Error" --msgbox "Invalid option selected!" 10 50 ;;
        esac
    done
}




run_command() {
    case $1 in
        "install-repo")
            install_repository &
            ;;
        "pull-repo")
            pull_repository &
            ;;
        "push-repo")
            push_repository &
            ;;
        "config-git")
            config_git &
            ;;
        "delete")
            delete_app &
            ;;
        "quit")
            exit 0
            ;;
        *)
            echo "Unknown command: $1"
            exit 1
            ;;
    esac
}




# ----------------------
# Entry Point
# ----------------------
main() {

    if [ $# -ge 1 ]; then
        run_command "$1"
    else
        # Check if Whiptail is installed
        if ! command -v whiptail &> /dev/null; then
            sudo apt update
            sudo apt install whiptail -y
        fi

        main_menu

    fi
}

main "$@"